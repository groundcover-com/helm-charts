apiVersion: v1
data:
  alerting_overrides.yaml: |
    apiVersion: 1
{{ if .Values.global.workflows.enabled }}
    contactPoints:
      - name: workflows-webhook
        receivers:
          - uid: workflows-webhook
            type: webhook
            settings:
              url: {{ include "keep.event.alert.url" . }}
              httpMethod: "POST"
              authorization_scheme: digest
              authorization_credentials: $KEEP_WEB_HOOK_API_KEY
    policies:
      - receiver: workflows-webhook
        group_by: ["grafana_folder","alertname"]
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 4h
{{ else }}
    policies: 
      - receiver: grafana-default-email
        group_by: ["grafana_folder","alertname"]
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 4h
{{ end }}
kind: ConfigMap
metadata:
  name: alerting-overrides-config