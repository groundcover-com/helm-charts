---
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: {{ printf "%s-auth" .Values.auth.namePrefix }}
plugin: key-auth
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ printf "%s-api-key" .Values.auth.namePrefix }}
type: Opaque
stringData:
  kongCredType: "key-auth"
  key: {{ .Values.global.groundcover_token }}
---
apiVersion: configuration.konghq.com/v1
kind: KongConsumer
metadata:
  name: {{ .Values.auth.namePrefix }}-api
  annotations:
    kubernetes.io/ingress.class: {{ .Values.kong.ingressController.ingressClass }}
    checksum/config: {{ .Values.global.groundcover_token | sha256sum }}
username: incloud-api
credentials:
- {{ printf "%s-api-key" .Values.auth.namePrefix }}
