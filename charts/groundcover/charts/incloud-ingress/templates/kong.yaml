---
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: {{ printf "%s-auth" .Release.Name }}
plugin: key-auth
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ printf "%s-api-key" .Release.Name }}
type: Opaque
stringData:
  kongCredType: "key-auth"
  key: {{ .Values.global.groundcover_token }}
---
apiVersion: configuration.konghq.com/v1
kind: KongConsumer
metadata:
  name: {{ printf "%s-api" .Release.Name }}
  annotations:
    checksum/config: {{ .Values.global.groundcover_token | sha256sum }}
    kubernetes.io/ingress.class: {{ .Values.kong.ingressController.ingressClass }}
username: api
credentials:
  - {{ printf "%s-api-key" .Release.Name }}
