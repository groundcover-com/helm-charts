global:
  temporal:
    enabled: true
# Custom temporal configuration (for our templates)
temporalConfig:
  adminTools:
    image:
      repository: us-docker.pkg.dev/groundcovercom/repo/temporalio/admin-tools
      tag: "1.29.1-tctl-1.18.4-cli-1.5.0"
      pullPolicy: IfNotPresent
  schemaSetup:
    hook: "post-install,pre-upgrade"
  namespaceSetup:
    hook: "post-install,pre-upgrade"
  postgres:
    host: "NONE"  # Set to "NONE" to read from secret, or specify host directly
    port: 5432
    database: temporal
    username: postgres
    secret:
      name: "managed-postgres-credentials"  # Default for production
      passwordKey: "password"  # Default key in production secrets
      hostKey: "host"  # Key in secret containing the host
      portKey: "port"  # Key in secret containing the port
      usernameKey: "username"  # Key in secret containing the username
    tls:
      enabled: true


# Temporal subchart values
# These are passed directly to the temporal subchart
temporal:
  # Server configuration
  server:
    replicaCount: 2
    image:
      repository: us-docker.pkg.dev/groundcovercom/repo/temporalio/server
      tag: 1.29.1
    config:
      persistence:
        defaultStore: default
        additionalStores: {}
        # Database configuration will be injected based on temporalConfig settings
        default:
          driver: sql
          sql:
            driver: postgres12
            host: "{{ .Env.TEMPORAL_STORE_HOST }}"
            port: "{{ .Env.TEMPORAL_STORE_PORT }}"
            database: "{{ .Env.TEMPORAL_STORE_DATABASE }}"
            user: "{{ .Env.TEMPORAL_STORE_USER }}"
            maxConns: 20
            maxIdleConns: 20
            maxConnLifetime: 1h
            tls:
              enabled: false
              enableHostVerification: false
        visibility:
          driver: sql
          sql:
            driver: postgres12
            host: "{{ .Env.TEMPORAL_VISIBILITY_HOST }}"
            port: "{{ .Env.TEMPORAL_VISIBILITY_PORT }}"
            database: "{{ .Env.TEMPORAL_VISIBILITY_DATABASE }}"
            user: "{{ .Env.TEMPORAL_VISIBILITY_USER }}"
            maxConns: 20
            maxIdleConns: 20
            maxConnLifetime: 1h
            tls:
              enabled: false
              enableHostVerification: false
  
  frontend:
    replicaCount: 2
    additionalEnv: []  # Will be overridden by parent chart or deployment
    podDisruptionBudget:
      maxUnavailable: 1

  history:
    replicaCount: 2
    additionalEnv: []  # Will be overridden by parent chart or deployment
    podDisruptionBudget:
      maxUnavailable: 1

  matching:
    replicaCount: 2
    additionalEnv: []  # Will be overridden by parent chart or deployment
    podDisruptionBudget:
      maxUnavailable: 1

  worker:
    replicaCount: 2
    additionalEnv: []  # Will be overridden by parent chart or deployment
    podDisruptionBudget:
      maxUnavailable: 1
  
  web:
    enabled: true
    replicaCount: 1
    image:
      repository: us-docker.pkg.dev/groundcovercom/repo/temporalio/ui
      tag: 2.42.1

  admintools:
    enabled: true
    image:
      repository: us-docker.pkg.dev/groundcovercom/repo/temporalio/admin-tools
      tag: 1.29.1-tctl-1.18.4-cli-1.5.0

  # Disable schema management - handled by our job
  schema:
    setup:
      enabled: false
    update:
      enabled: false
    createDatabase:
      enabled: false

  # Disable all data stores we don't use
  cassandra:
    enabled: false
  mysql:
    enabled: false
  postgresql:
    enabled: false
  elasticsearch:
    enabled: false
  prometheus:
    enabled: false
  grafana:
    enabled: false
